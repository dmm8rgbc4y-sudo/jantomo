{% extends 'base.html' %}
{% block title %}日程入力 - じゃんとも{% endblock %}

{% block content %}

{% if is_past_week %}
<div class="info-banner" style="text-align:center; margin-bottom: 10px; color:#666; font-size:14px;">
  この週は<strong>過去の週</strong>のため、編集できません。
</div>
{% endif %}

<!-- Safari 対策：hidden input で token を渡す -->
<input type="hidden" id="csrf-token-source" value="{{ csrf_token() }}">

<div class="week-nav">
  <a href="{{ url_for('schedule.schedule', week=week_offset - 1) }}">＜ 前の週</a>
  <strong>{{ dates[0].strftime("%m/%d") }} ～ {{ dates[-1].strftime("%m/%d") }}</strong>
  <a href="{{ url_for('schedule.schedule', week=week_offset + 1) }}">次の週 ＞</a>
</div>

<div id="schedule-container">
  {% for d in dates %}
  {% set saved_type = saved_dict.get(d.strftime('%Y-%m-%d')) %}
  <div class="date-row"
       data-date="{{ d.strftime('%Y-%m-%d') }}">

    <span class="date-label">{{ d.strftime('%m/%d(%a)') }}</span>

    <button class="time-btn {% if saved_type == '昼' %}selected{% endif %}" data-slot="day" {% if is_past_week %}disabled{% endif %}>昼</button>
    <button class="time-btn {% if saved_type == '夜' %}selected{% endif %}" data-slot="night" {% if is_past_week %}disabled{% endif %}>夜</button>
    <button class="time-btn {% if saved_type == '両方' %}selected{% endif %}" data-slot="both" {% if is_past_week %}disabled{% endif %}>両方</button>
  </div>
  {% endfor %}
</div>

{% if not is_past_week %}
<div style="text-align:center; margin-top: 20px;">
  <button id="save-btn">決定</button>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
  const csrf_token = document.getElementById("csrf-token-source").value;
  const WEEK_OFFSET = JSON.parse('{{ week_offset | tojson }}');
</script>

<script src="{{ url_for('static', filename='js/schedule.js') }}"></script>
{% endblock %}
