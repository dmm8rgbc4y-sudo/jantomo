{% extends 'base.html' %}
{% block title %}æ—¥ç¨‹å…¥åŠ› - ã˜ã‚ƒã‚“ã¨ã‚‚{% endblock %}

{% block content %}

{% if is_past_week %}
<div class="info-banner" style="text-align:center; margin-bottom: 10px; color:#666; font-size:14px;">
  ã“ã®é€±ã¯<strong>éå»ã®é€±</strong>ã®ãŸã‚ã€ç·¨é›†ã§ãã¾ã›ã‚“ã€‚
</div>
{% endif %}

<div class="week-nav">
  <a href="{{ url_for('schedule.schedule', week=week_offset - 1) }}">ï¼œ å‰ã®é€±</a>
  <strong>{{ dates[0].strftime("%m/%d") }} ï½ {{ dates[-1].strftime("%m/%d") }}</strong>
  <a href="{{ url_for('schedule.schedule', week=week_offset + 1) }}">æ¬¡ã®é€± ï¼</a>
</div>

<div id="schedule-container">
  {% for d in dates %}
  {% set saved_type = saved_dict.get(d.strftime('%Y-%m-%d')) %}
  <div class="date-row"
       data-date="{{ d.strftime('%Y-%m-%d') }}">

    <span class="date-label">{{ d.strftime('%m/%d(%a)') }}</span>

    <button class="time-btn {% if saved_type == 'æ˜¼' %}selected{% endif %}" data-slot="day" {% if is_past_week %}disabled{% endif %}>æ˜¼</button>
    <button class="time-btn {% if saved_type == 'å¤œ' %}selected{% endif %}" data-slot="night" {% if is_past_week %}disabled{% endif %}>å¤œ</button>
    <button class="time-btn {% if saved_type == 'ä¸¡æ–¹' %}selected{% endif %}" data-slot="both" {% if is_past_week %}disabled{% endif %}>ä¸¡æ–¹</button>
  </div>
  {% endfor %}
</div>

{% if not is_past_week %}
<div style="text-align:center; margin-top: 20px;">
  <button id="save-btn">æ±ºå®š</button>
</div>
{% endif %}

{% endblock %}

{% block scripts %}

<!-- ğŸ”¥ æ–¹æ³•â‘ ï¼šCSRF & WEEK_OFFSET ã‚’ Flask â†’ JS ã«ç›´æ¥åŸ‹ã‚è¾¼ã‚€æœ€å®‰å®šæ–¹å¼ -->
<script>
  // @ts-nocheck
  window.CSRF_TOKEN = "{{ csrf_token() }}";
  window.WEEK_OFFSET = Number("{{ week_offset }}");
</script>

<!-- schedule.js ã¯ã“ã®ä¸‹ã§ç¢ºå®Ÿã« CSRF_TOKEN ã‚’å‚ç…§å¯èƒ½ -->
<script src="{{ url_for('static', filename='js/schedule.js') }}"></script>

{% endblock %}
